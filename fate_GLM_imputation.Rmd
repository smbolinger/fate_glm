---
title: "Untitled"
author: "Sarah Bolinger"
date: "`r Sys.Date()`"
output: html_document
---


#########################################################################################
## Run all of these once:

### Functions

#### Basic mice functionality: impute, fit, pool

```{r, warning=FALSE}
source("mice_functions.R")
```

#### Functions to create interaction plots including imputed data:

```{r, warning=FALSE}
# source("imp_interaction_plot.R")
```

#### Function to create the pooled regression table for the top model:

```{r, warning=FALSE}
# source("imp_reg_tab.R")
source("other_imp.R")
```

#### Functions to make simulated NAs & impute,etc. to test the imputation method being used

```{r}
source("imp_sim_functions.R")
# source("suppress_warnings.R")
```

### OPTIONAL:
#### Create a small set of imputations (m=10) for testing code (does not run during knitting)

```{r eval=FALSE, include=FALSE, warning=FALSE}
# source("small_imputation.R")
small_imp()
```

#### How many imputations?

```{r eval=FALSE, warning=FALSE, include=FALSE}
modList
impDatTest <- mice::mice(imppDat, m=20, method='pmm', printFlag=FALSE)
# fitTest    <- with(impDatTest, glm())
fitTest <- impFit(impDatTest, modList = modList)
howManyImp <- lapply(fitTest, function(x) howManyImputations::how_many_imputations(x, cv=0.05))
```

## .
#########################################################################################
## Run all of these for each separate analysis:

### Create imputed datasets (m=30)

Select the variables to impute and create a "shadow matrix"

```{r}

# col_sel <- c(prVars, "HF_mis", "is_u") # columns to select, as strings
col_sel <- c(prVars, resp1, resp2) # columns to select, as strings
# col_sel
# met     <- "pmm"

# dat4imp <- get(datNameImp) %>% select(all_of(col_sel)) %>% naniar::bind_shadow() 
dat4imp <- get(datNameImp) %>% select(all_of(col_sel))
d4i_shadow <- naniar::as_shadow(dat4imp)
# %>% mice::md.pattern()

# impInt <- impStrat(datNameImp, met="pmm", col_sel)
impInt <- impStrat(datNameImp, met=impMet, col_sel)
```

### DIAGNOSTICS

#### Plots
These functions are from mice_plots.R

```{r}
# mice::densityplot(impInt)
# density_plot(impInt)
imp_plot(impInt, plType = "density")

```

```{r}
# mice::xyplot(impInt, nest_age ~ fdate)
imp_plot(impInt, nest_age ~ fdate, plType="xy")
```



